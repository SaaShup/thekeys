
<!DOCTYPE html>
<html>
<head>
  <title>The Keys</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="https://www.the-keys.eu/en/">TheKeys</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
      <div class="navbar-nav">
        <a class="nav-link active" aria-current="page" href="/help.html" target="_blank">Help</a>
      </div>
    </div>
  </div>
</nav>
    <div class="container text-center my-5"><h2><a target="_blank" href="https://www.the-keys.eu/en/">TheKeys</a> Locker </h2></div>
    <div class="container text-center">
	    <div class="row m-3"><center><input class="form-control" type="text" value="" id="ip" style="max-width:300px;"/></center></div>
	<div class="row m-3"><center><input class="form-control" type="text" value="" id="code" style="max-width:300px;"/></center></div>
	<div class="row m-3"><center><input class="form-control" type="text" value="" id="id" style="max-width:300px;"/></center></div>
	<div class="row">
		<div class="col-sm-12 col-md-4 my-2"><button class="btn btn-primary" id="locker_status">Locker status</button></div>
		<div class="col-sm-12 col-md-4 my-2"><button class="btn btn-primary" id="locker_close">Locker close</button></div>
		<div class="col-sm-12 col-md-4 my-2"><button class="btn btn-primary" id="locker_open">Locker open</button></div>
	</div>
	<hr>
	<div class="alert alert-primary" role="alert"><pre class="fw-bold" id="response">N/A</pre></div>
    </div>
<script>

const searchParams = new URLSearchParams(window.location.search);
var ip = window.localStorage.getItem('ip') || searchParams.get('ip') || '192.168.1.1'
var code = window.localStorage.getItem('code') || searchParams.get('code') || ''
var id = window.localStorage.getItem('id') || searchParams.get('id') || ''

$('#ip').val(ip)
$('#id').val(id)
$('#code').val(code)

function save() {
  ip = $('#ip').val()
  id = $('#id').val()
  code = $('#code').val()
  window.localStorage.setItem('ip', ip)
  window.localStorage.setItem('id', id)
  window.localStorage.setItem('code', code)
}

function fetchLocker (action) {
  $('#response').html(action + ' has been sent.<br>Waiting for reply...')
  fetch(action, {
	method: 'post',
	body:    JSON.stringify({
		ip: ip,
		id: id,
		code: code
	}),
        headers: { 'Content-Type': 'application/json' }
  })
  .then(function (response) {
    return response.json();
  })
  .then(function (json) {
    $('#response').html(JSON.stringify(json, null, 2))
  })
  .catch(function (error) {
    console.log("Error: " + error);
  });
}

$('#locker_status').on('click', function (event) {
	save();
	if (ip && id && code) fetchLocker("/locker_status")
});

$('#locker_open').on('click', function (event) {
	save();
        if (ip && id && code) fetchLocker("/open")
});

$('#locker_close').on('click', function (event) {
	save();
        if (ip && id && code) fetchLocker("/close")
});

if (searchParams.get('action')) $(searchParams.get('action')).click();

</script>
<footer class="w-100">
  <center><a href="https://saashup.com" style="text-decoration: none;" target="_blank">saashup</a></center>
</footer>
</body>
</html>

